{"version":3,"kind":"Notebook","sha256":"8c397c0f4e5ad8ab287a6f10053be37d5e979b70347eec110ce3e7b299523cab","slug":"molecular-dynamics","location":"/ode/ressources/molecular_dynamics.ipynb","dependencies":[],"frontmatter":{"title":"Molecular Dynamics : simulation of a crystal formation in 2D","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/symmeHub/positron","numbering":{"title":{"offset":2}},"source_url":"https://github.com/symmeHub/positron/blob/main/book/ode/ressources/molecular_dynamics.ipynb","edit_url":"https://github.com/symmeHub/positron/edit/main/book/ode/ressources/molecular_dynamics.ipynb","exports":[{"format":"ipynb","filename":"molecular_dynamics.ipynb","url":"/armageddon/build/molecular_dynamics-e601722b92984474d2194a3252a497ec.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib widget\nfrom IPython.display import Image\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nfrom matplotlib import animation, rc\nimport sympy as sp\nimport pandas as pd\nfrom PMD import PMD, distances\n\nsp.init_printing(use_latex=\"mathjax\")\nrc(\"animation\", html=\"html5\")","visibility":"show","key":"r6jWwIKOpS"},{"type":"outputs","id":"iZt_9zmrQYy5hXkfDqlU1","children":[],"visibility":"show","key":"p2bSJTgUdo"}],"visibility":"show","key":"UCbPgZp6oM"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Molecular Dynamics : simulation of a crystal formation in 2D","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QN8jnU2k6t"}],"label":"MD_notebook","identifier":"md_notebook","html_id":"md-notebook","key":"XDCs2G5hgz"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Atomic simulation using the Morse potential","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AxSgp0hn1T"}],"key":"qgsAel2KBW"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://en.wikipedia.org/wiki/Morse_potential","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Morse potential","key":"i8EvztO3K4"}],"urlSource":"https://en.wikipedia.org/wiki/Morse_potential","data":{"page":"Morse_potential","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"CVQ1BZP4wb"}],"key":"DbG1JA9ovx"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"This notebook uses the (Point Mass Dynamics) PMD class to simulate gravitational interaction between massive objects.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TutcKBQsCv"}],"key":"RBE4dehNyJ"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Required files","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gW7jIcC6B3"}],"key":"rt4jQTIgPt"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Before using this notebook, download the module ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"kJHHjG0ZLk"},{"type":"link","url":"/armageddon/build/PMD-6bb95a16675cd6323c18059b96986b67.py","static":true,"children":[{"type":"text","value":"PMD.py","key":"zL3zZgEZ7c"}],"urlSource":"PMD.py","protocol":"file","key":"RhyP3PQfPK"},{"type":"text","value":" and put it in your working directory.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"RV87GAvvI3"}],"key":"wRmhcYR1Yc"}],"class":"important","key":"HGTJXAS6tw"}],"visibility":"show","key":"dVSeFOT0rA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Image(\n    url=\"https://upload.wikimedia.org/wikipedia/commons/7/7a/Morse-potential.png\",\n    width=500,\n    height=500,\n)","key":"dyFzw0qM3k"},{"type":"outputs","id":"vCcpnZa-rXRiosKxVlt6E","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/html":{"content":"<img src=\"https://upload.wikimedia.org/wikipedia/commons/7/7a/Morse-potential.png\" width=\"500\" height=\"500\"/>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"key":"JQSCFbJMx3"}],"key":"mEMknLOpdz"}],"key":"qCsEO9ghXt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"PMD module","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UINJAPD023"}],"identifier":"pmd-module","label":"PMD module","html_id":"pmd-module","implicit":true,"key":"ulUKMkl5jV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PMD module available here: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M98f5qsI40"},{"type":"link","url":"/armageddon/build/PMD-6bb95a16675cd6323c18059b96986b67.py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PMD.py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KcBwrFyP3h"}],"urlSource":"./PMD.py","static":true,"protocol":"file","key":"dQjmuwCi8b"}],"key":"WomBARBNOp"}],"key":"ufI853mCdd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Potential","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j7uZhZ6Ze4"}],"identifier":"potential","label":"Potential","html_id":"potential","implicit":true,"key":"ELARo8GDeF"}],"key":"lXm3ZjJn7G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"De, a, re, r = sp.symbols(\"D_e a r_e r\")\nV = De * (1 - sp.exp(-a * (r - re))) ** 2\nV","key":"tw0GWwZo75"},{"type":"outputs","id":"MD8kIILOK69xr48IGxzb0","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"                     2\n   ⎛     -a⋅(r - rₑ)⎞ \nDₑ⋅⎝1 - ℯ           ⎠ ","content_type":"text/plain"},"text/latex":{"content":"$\\displaystyle D_{e} \\left(1 - e^{- a \\left(r - r_{e}\\right)}\\right)^{2}$","content_type":"text/latex"}}},"key":"ZdOlKN23WK"}],"key":"muZCZQjAQW"}],"key":"ezJP6s74sV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Force","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J4kO6k5nVk"}],"identifier":"force","label":"Force","html_id":"force","implicit":true,"key":"gFxDXumlSH"}],"key":"BSOkFpsbNB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"F = -V.diff(r)\nF","key":"mSzZqCRHjI"},{"type":"outputs","id":"4nPnEyih0HzaTZUCgtJfA","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"        ⎛     -a⋅(r - rₑ)⎞  -a⋅(r - rₑ)\n-2⋅Dₑ⋅a⋅⎝1 - ℯ           ⎠⋅ℯ           ","content_type":"text/plain"},"text/latex":{"content":"$\\displaystyle - 2 D_{e} a \\left(1 - e^{- a \\left(r - r_{e}\\right)}\\right) e^{- a \\left(r - r_{e}\\right)}$","content_type":"text/latex"}}},"key":"Pm3gHs97Im"}],"key":"oUaRncxcN4"}],"key":"o5zxWBcN8f"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plotting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nx5iRciekr"}],"identifier":"plotting","label":"Plotting","html_id":"plotting","implicit":true,"key":"bOCwmfOnX3"}],"key":"BBXWxwfLKm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"values = {De: 1.0, a: 2.0, re: 1}\nVf = sp.lambdify(r, V.subs(values), \"numpy\")\nFf = sp.lambdify(r, F.subs(values), \"numpy\")\nvr = np.linspace(0.3 * values[re], 5 * values[re], 100)\nfig = plt.figure()\nax = fig.add_subplot(2, 1, 1)\nplt.ylim(0, 5)\nplt.plot(vr, Vf(vr))\nplt.grid()\nplt.ylabel(\"Potential Value, $V$\")\nax = fig.add_subplot(2, 1, 2)\nplt.ylim(-2.5, 5)\nplt.plot(vr, Ff(vr))\nplt.grid()\nplt.xlabel(\"Interatomic Distance, $r$\")\nplt.ylabel(\"Force Value, $F$\")\nplt.show()","visibility":"hide","key":"T2D3k9nSb2"},{"type":"outputs","id":"1h_6rzxjCZNXpE1vF0GVR","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1cf207fa74bbfc5692b92d43e5ce145e","path":"/armageddon/build/1cf207fa74bbfc5692b92d43e5ce145e.png"},"text/html":{"content_type":"text/html","hash":"7b2c5285a94a26bdbca1a2cfa6a9716f","path":"/armageddon/build/7b2c5285a94a26bdbca1a2cfa6a9716f.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"bac660ad60fd4b58aa46a3637ce50169\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"TNhMbyEwxz"}],"visibility":"show","key":"MweO7lm4uo"}],"visibility":"show","key":"sdLgu6tyL6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class MD(PMD):\n    \"\"\"\n    Molecular dynamics w. Morse potential.\n    \"\"\"\n\n    def __init__(self, De=1.0, a=1.0, re=1.0, mu=0.0, **kwargs):\n        self.De = De\n        self.a = a\n        self.re = re\n        self.mu = mu\n        super().__init__(**kwargs)\n\n    def derivative(self, X, t, cutoff_radius=1.0e-2):\n        De, a, re, mu = self.De, self.a, self.re, self.mu\n        n = len(m)\n        P = X[: 2 * n].reshape(n, 2)\n        V = X[2 * n :].reshape(n, 2)\n        M = m * m[:, np.newaxis]\n        D, R, U = distances(P)\n        np.fill_diagonal(R, np.inf)\n        if cutoff_radius > 0.0:\n            R = np.where(R > cutoff_radius, R, cutoff_radius)\n        # F =((G * M * R**-2)[:,:,np.newaxis] * U).sum(axis = 0)\n        F = (\n            (2.0 * De * a * (1.0 - np.exp(-a * (R - re))) * np.exp(-a * (R - re)))[\n                :, :, np.newaxis\n            ]\n            * U\n        ).sum(axis=0) - mu * (V**2).sum(axis=0) ** 1.5 * V\n        A = (F.T / m).T\n        X2 = X.copy()\n        X2[: 2 * n] = V.flatten()\n        X2[2 * n :] = A.flatten()\n        return X2\n\n    def potential(self, P):\n        De, a, re, mu = self.De, self.a, self.re, self.mu\n        D, R, U = distances(P)\n        return (\n            np.where(R != 0.0, De * a * (1 - np.exp(-a * (R - re))) ** 2, 0.0).sum()\n            / 2.0\n        )","key":"leJf6LeUbf"},{"type":"outputs","id":"QmjkCHEff3NsLhpI5po12","children":[],"key":"Vz4nnlpr7t"}],"key":"yYaYgPS9ck"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"np.random.seed(666)\nre = 0.9\nnmx = 6\nnmy = 6\nnm = nmx * nmy\nx0 = np.arange(nmx) * re * 1.2\ny0 = np.arange(nmy) * re * 1.2\nX0, Y0 = np.meshgrid(x0, y0)\nP0 = np.array([X0.flatten(), Y0.flatten()]).T\nP0 *= 1.0 + np.random.rand(*P0.shape) * 0.1\nP0 -= P0.mean(axis=0)\nV0 = np.zeros_like(P0)\npcolors = \"r\"\ntcolors = \"b\"\nm = np.ones(nm) * 1.0e0\ns = MD(m=m, P=P0, V=V0, mu=0.05, re=re, a=10, De=0.5, nk=1000)\ndt = 1.0e-1\nnt = 100\n\n\nfig = plt.figure()\nax = fig.add_subplot(1, 1, 1)\nax.set_aspect(\"equal\")\nax.axis(\"off\")\nmargin = 1.0\nplt.xlim(P0[:, 0].min() - margin, P0[:, 0].max() + margin)\nplt.ylim(P0[:, 1].min() - margin, P0[:, 1].max() + margin)\n# plt.grid()\n# ax.axis(\"off\")\npoints = []\n\nmsize = 10.0 * (s.m / s.m.max()) ** (1.0 / 6.0)\nfor i in range(nm):\n    plc = len(pcolors)\n    pc = pcolors[i % plc]\n    tlc = len(tcolors)\n    tc = tcolors[i % tlc]\n    (trail,) = ax.plot([], [], \"-\" + tc)\n    (point,) = ax.plot([], [], \"o\" + pc, markersize=msize[i])\n    points.append(point)\n    points.append(trail)\n\n\ndef init():\n    for i in range(2 * nm):\n        points[i].set_data([], [])\n    return points\n\n\ndef animate(i):\n    s.solve(dt, nt)  # , rtol = 1.e-8, atol = 1.e-8)\n    x, y = s.xy()\n    for i in range(nm):\n        points[2 * i].set_data(x[i : i + 1], y[i : i + 1])\n        xt, yt = s.trail(i)\n        points[2 * i + 1].set_data(xt, yt)\n    return points\n\n\nanim = animation.FuncAnimation(\n    fig, animate, init_func=init, frames=400, interval=20, blit=True\n)\n\n\n# plt.show()\nplt.close()\nanim","key":"BLyd9q0GMJ"},{"type":"outputs","id":"J5J2AvqtPaz_20U5Ci4XK","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"<matplotlib.animation.FuncAnimation at 0x725b81276e40>","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"15e925e2ede0a670dabc4527dd8c5e36","path":"/armageddon/build/15e925e2ede0a670dabc4527dd8c5e36.html"}}},"key":"iMFOJAdh7Y"}],"key":"Ys1Oi1ucYH"}],"key":"weRWlEAdXB"}],"key":"HvzqpXvowR"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Simulation of a set of bodies subjected to gravity","url":"/gravity","group":"ODE"},"next":{"title":"Exercices","url":"/exercises-3","group":"ODE"}}},"domain":"http://localhost:3002"}