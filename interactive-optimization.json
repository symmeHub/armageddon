{"version":3,"kind":"Notebook","sha256":"e35052ad559a40e17d378c9c40e0756ba3fb9c2d39ed1a61e1c4a49530a225c0","slug":"interactive-optimization","location":"/optimization/ressources/interactive_optimization.ipynb","dependencies":[],"frontmatter":{"title":"Interactive optimization","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"IR_env","language":"python"},"github":"https://github.com/symmeHub/positron","numbering":{"title":{"offset":2}},"source_url":"https://github.com/symmeHub/positron/blob/main/book/optimization/ressources/interactive_optimization.ipynb","edit_url":"https://github.com/symmeHub/positron/edit/main/book/optimization/ressources/interactive_optimization.ipynb","exports":[{"format":"ipynb","filename":"interactive_optimization.ipynb","url":"/armageddon/build/interactive_optimiza-6eb24fa3edb913ea1e874f902b3efd56.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"toc":true},"children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"Table of Contents","key":"oMOY7j9k0T"},{"type":"span","class":"tocSkip","children":[],"key":"fRVrlnSgro"}],"identifier":"table-of-contents","label":"Table of Contents","html_id":"table-of-contents","implicit":true,"key":"Bx1bMFaJ5G"},{"type":"div","class":"toc","children":[{"type":"list","ordered":false,"start":null,"spread":false,"children":[],"key":"QyIKUxWmQR"}],"key":"Fio0u951bn"}],"key":"ea411UWORj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Interactive optimization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cmujGbw40f"}],"identifier":"interactive-optimization","label":"Interactive optimization","html_id":"interactive-optimization","implicit":true,"key":"g85ufOs3nt"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":".. codeauthor:: Emile Roux, Ludovic Charleux","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZFEZTTHgJ1"}],"key":"nJeqAoNyb3"},{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Background","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xiAkMXwMMg"}],"identifier":"background","label":"Background","html_id":"background","implicit":true,"key":"E7h5A9Edgr"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"The starting point, also known as the initial guess or initial solution, is crucial in optimization because it can greatly impact the outcome of the optimization process.\nIn optimization, the goal is to find the optimal solution that maximizes or minimizes a certain objective function.\nIf the initial guess is far from the optimal solution, it may take a long time for the algorithm to converge to the optimal solution, or it may converge to a suboptimal solution instead.\nTherefore, selecting a good starting point that is close to the optimal solution can greatly improve the efficiency and accuracy of the optimization process.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GEL7vXD55Z"}],"key":"NNT4nJwnZJ"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"As alternative to over come this issue, global optimization algorithms can be used. The use of the ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Sw4ObU9ZN8"},{"type":"link","url":"https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.direct.html","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"DIRECT","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"hn6WEKTUQn"}],"urlSource":"https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.direct.html","key":"XREkwFVrQy"},{"type":"text","value":" algorithm presented here to illustarte the concept of global optimization.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ZyEaGhgETO"}],"key":"cI8zZr6gOk"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"The Goal of this notebook is to understand this keypoint of optimisation.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"q64V03dmzf"}],"key":"JxEibQnX9z"}],"key":"q5x5b27gnw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib widget\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom scipy import optimize\n\nimport ipywidgets as ipw\nfrom matplotlib import cm","visibility":"hide","key":"RUSXc1LlFj"},{"type":"outputs","id":"RlgPwC1gqxiB2LwFF8xQp","children":[],"visibility":"show","key":"cmVZPydm02"}],"visibility":"show","key":"cBzsFOJJEh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Definition of the cost function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VDjnqJvFSF"}],"identifier":"definition-of-the-cost-function","label":"Definition of the cost function","html_id":"definition-of-the-cost-function","implicit":true,"key":"PjVrWYw1Y2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The 2D Himmelblau cost function is used to illustrate the starting point importantce.\n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j6OodV6n29"},{"type":"link","url":"https://en.wikipedia.org/wiki/Himmelblau%27s_function","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"https://en.wikipedia.org/wiki/Himmelblau's_function","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jrUO8v8SGQ"}],"urlSource":"https://en.wikipedia.org/wiki/Himmelblau%27s_function","data":{"page":"Himmelblau%27s_function","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"lWUlw1jY9t"}],"key":"HFf5PVRCjR"}],"key":"XPrMDEsPiN"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def cost(p):\n    global counter, P\n    \"\"\"\n    Himmelblau cost function.\n    https://en.wikipedia.org/wiki/Himmelblau%27s_function\n    \"\"\"\n    x, y = p\n    return (x**2 + y - 11) ** 2 + (x + y**2 - 7) ** 2\n\n\nNx, Ny = 100, 100\nx = np.linspace(-5.0, 5.0, Nx)\ny = np.linspace(-5.0, 5.0, Ny)\nX, Y = np.meshgrid(x, y)\nzf = np.array([X.flatten(), Y.flatten()])\nZ = cost(zf).reshape(Nx, Ny)\nZ = np.where(Z > 200.0, np.nan, Z)\n\nplt.figure()\ntitle = plt.title(\"\")\nplt.contourf(X, Y, Z, 20, cmap=cm.jet)\nplt.colorbar()\nplt.contour(X, Y, Z, 20, cmap=cm.gray)\nplt.show()","visibility":"hide","key":"Ogzcp4F8I6"},{"type":"outputs","id":"sSO00I2cX1JvlYaK0IPsk","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1d909d035cb5776a4736ce49c3d0a5f3","path":"/armageddon/build/1d909d035cb5776a4736ce49c3d0a5f3.png"},"text/html":{"content_type":"text/html","hash":"25cd9b496ca1fdc25cb4d35f3424daf3","path":"/armageddon/build/25cd9b496ca1fdc25cb4d35f3424daf3.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"b8302c13a5e044d7acdbf5dbc2d148fd\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"M4UwcGhnkJ"}],"visibility":"show","key":"t6YaUGgfaH"}],"visibility":"show","key":"MFc4LT8gKr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This 2D function shows 4 different minima.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gL1Sv2upjs"}],"key":"Ll9cm4l8Nc"}],"key":"NMlDpI8EpU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Bluid a animated plot to have fun with starting points","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bfH7bfvLlm"}],"identifier":"bluid-a-animated-plot-to-have-fun-with-starting-points","label":"Bluid a animated plot to have fun with starting points","html_id":"bluid-a-animated-plot-to-have-fun-with-starting-points","implicit":true,"key":"YflFs6unST"}],"key":"gWIZ4YOUGS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"counter = 1\nP = np.zeros((1000, 2))\nP[0] = -1.0, 0.0\n\n\ndef cost_and_track(xk):\n    global counter, P\n    P[counter, :] = xk\n    counter += 1\n    return cost(xk)\n\n\nplt.figure()\ntitle = plt.title(\"\")\nplt.contourf(X, Y, Z, 20, cmap=cm.jet, alpha=0.5)\nplt.colorbar()\nplt.contour(X, Y, Z, 20, cmap=cm.gray)\n(line,) = plt.plot(P[:, 0], P[:, 1], \"om\", label=\"Path\")\n(line0,) = plt.plot(P[:1, 0], P[:1, 1], \"r*\", label=\"Start\")\n(line1,) = plt.plot(\n    P[counter - 1 : counter, 0], P[counter - 1 : counter, 1], \"bs\", label=\"End\"\n)\nplt.grid()\nplt.legend()\n# plt.tight_layout()\n\n\n@ipw.interact(\n    x0=(-4.0, 4, 0.1),\n    y0=(-4.0, 4, 0.1),\n    algorithm=[\"Nelder-Mead\", \"BFGS\", \"Powell\", \"DIRECT\"],\n)\ndef run_optimization(x0=0.0, y0=0.0, algorithm=\"Nelder-Mead\"):\n    global P, counter, counterCostCall\n    counter = 1\n    P *= np.nan\n    P[0] = x0, y0\n    if algorithm == \"DIRECT\":\n        bounds = optimize.Bounds([-6.0, -6.0], [6.0, 6.0])\n        sol = optimize.direct(\n            cost_and_track, bounds, f_min=-1.0, eps=1e-2, vol_tol=1e-10\n        )\n    else:\n        sol = optimize.minimize(cost_and_track, [x0, y0], method=algorithm)\n    line.set_xdata(P[:, 0])\n    line.set_ydata(P[:, 1])\n    line0.set_xdata(P[:1, 0])\n    line0.set_ydata(P[:1, 1])\n    line1.set_xdata(P[counter - 1 : counter, 0])\n    line1.set_ydata(P[counter - 1 : counter, 1])\n    title.set_text(\n        \"Alg:{0}, CostCall: {1}, sol=({2:.1f},{3:.1f})\".format(\n            algorithm, counter, sol.x[0], sol.x[1]\n        )\n    )","key":"tbMRQrgqeJ"},{"type":"outputs","id":"TxHq2y3fvVNFxmeuzJ-lm","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"interactive(children=(FloatSlider(value=0.0, description='x0', max=4.0, min=-4.0), FloatSlider(value=0.0, desc…","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"fef50b04b09b42beb4bc1dcd39fdd274\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"k5n1K36w8g"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Canvas(toolbar=Toolbar(toolitems=[('Home', 'Reset original view', 'home', 'home'), ('Back', 'Back to previous …","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"cc439059635d75dc9091dedbcf7f39f2","path":"/armageddon/build/cc439059635d75dc9091dedbcf7f39f2.png"},"text/html":{"content_type":"text/html","hash":"de088971e32b25f15574a11738739480","path":"/armageddon/build/de088971e32b25f15574a11738739480.html"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"51d4f62e93bb4a8b85354793b1a2155c\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"ASbJfCcelF"}],"key":"JkuepGYM0v"}],"key":"gZ9c380rqM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"By changing the starting point and optimization method, we can observe:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TuY0g4nK7v"}],"key":"nnh1gtwxqt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The optimization process converged toward different minimum.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qjMIsmX4OA"}],"key":"XUznWAtdRA"}],"key":"ccvCXeom50"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Number of iterations is not constant.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QsTARx33Vl"}],"key":"tgC4oeDlpi"}],"key":"chbG5J1tmg"}],"key":"QbZR8UlKW6"}],"key":"bsGJ52dp2e"}],"key":"fkE978iuVg"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Ressources","url":"/ressources-2","group":"Optimization"},"next":{"title":"Illustration : Crossing a river","url":"/river-crossing-and-more","group":"Optimization"}}},"domain":"http://localhost:3002"}