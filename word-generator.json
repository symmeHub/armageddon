{"version":3,"kind":"Notebook","sha256":"41280ba35e2b83ea1216f716ad4d848c0f2ec8d1201edbce0a4a35fc213682a3","slug":"word-generator","location":"/data_analysis/ressources/Word_Generator.ipynb","dependencies":[],"frontmatter":{"title":"Word Generator","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"science","language":"python"},"github":"https://github.com/symmeHub/positron","numbering":{"title":{"offset":2}},"source_url":"https://github.com/symmeHub/positron/blob/main/book/data_analysis/ressources/Word_Generator.ipynb","edit_url":"https://github.com/symmeHub/positron/edit/main/book/data_analysis/ressources/Word_Generator.ipynb","exports":[{"format":"ipynb","filename":"Word_Generator.ipynb","url":"/armageddon/build/Word_Generator-111813ff59a6ee4e3ee314aab32e9f68.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"subslide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Scope","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hKolDFvcs7"}],"identifier":"scope","label":"Scope","html_id":"scope","implicit":true,"key":"l4EeIvgovA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook was inspired by the great video proposed by David Louapre available on his Youtube channel ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R4zYivx8OO"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"“Science Etonnante”","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pHiiRocKun"}],"key":"rEY95sL2vO"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CyqXwt5SBb"}],"key":"qVADk9e00E"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://sciencetonnante.wordpress.com/2015/11/06/la-machine-a-inventer-des-mots-version-ikea/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://​sciencetonnante​.wordpress​.com​/2015​/11​/06​/la​-machine​-a​-inventer​-des​-mots​-version​-ikea/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"o9OWeTe6kV"}],"urlSource":"https://sciencetonnante.wordpress.com/2015/11/06/la-machine-a-inventer-des-mots-version-ikea/","key":"xKVbcOTMRY"}],"key":"wo0oR0AHs1"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Here the word generator is embedded in a class.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dQVWERz7X6"}],"key":"cBv67bSMOH"}],"key":"VMeAQDEo3J"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"slide"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Setup\n%load_ext autoreload\n%matplotlib ipympl\n%autoreload 2\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nimport IPython, io, urllib\nimport codecs\nimport re\nfrom numpy.random import choice, seed\n\nseed(1)","visibility":"hide","key":"sXuQBUQLUN"},{"type":"outputs","id":"ytS6UsAxLctd9SOXn22_R","children":[],"visibility":"show","key":"KrE5FgD6gL"}],"visibility":"show","key":"XVUv40TlDB"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The video","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rBUL1oVY7p"}],"identifier":"the-video","label":"The video","html_id":"the-video","implicit":true,"key":"P6xHKZMXfZ"}],"key":"P6Cp4qb7DT"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"-"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"IPython.display.YouTubeVideo(\"YsR7r2378j0\")","visibility":"show","key":"Beg934SbtJ"},{"type":"outputs","id":"vIfRtSRlRf5F9DHE3B6oC","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"<IPython.lib.display.YouTubeVideo at 0x7986cf24ea80>","content_type":"text/plain"},"text/html":{"content":"\n        <iframe\n            width=\"400\"\n            height=\"300\"\n            src=\"https://www.youtube.com/embed/YsR7r2378j0\"\n            frameborder=\"0\"\n            allowfullscreen\n            \n        ></iframe>\n        ","content_type":"text/html"},"image/jpeg":{"content_type":"image/jpeg","hash":"d897957e1083f7df3ffb3adf482e67ea","path":"/armageddon/build/d897957e1083f7df3ffb3adf482e67ea.jpeg"}}},"key":"Z0Ho2SMnFC"}],"visibility":"show","key":"QTPlqLbKPn"}],"visibility":"show","key":"TNgpxzQcQS"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Class that manage the word generator","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N0XYHhVjgE"}],"identifier":"the-class-that-manage-the-word-generator","label":"The Class that manage the word generator","html_id":"the-class-that-manage-the-word-generator","implicit":true,"key":"KIafQHcOXJ"}],"key":"RkZlvilnSb"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"-"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"class word_generator:\n    def __init__(self, dic_file):\n        # Input file containing one word per line, and its encoding\n        # Assumes one word per line but if the the words are followed by\n        # a space, a tab, a slash, a comma, etc....the end of the line will be trimmed\n        self.dic_file = dic_file\n        self.encoding = \"ISO-8859-1\"\n\n        # Name of the output binary matrix, matrix image file and output txt file\n        count_file = r\"count_FR.bin\"\n        proba_matrix = r\"matrix_FR.png\"\n        self.outfile = r\"output.txt\"\n\n        self.read_dic()\n\n    def read_dic(self):\n        self.dico = []  # to store the words of the dictionnary\n\n        self.count = np.zeros((256, 256, 256), dtype=\"int32\")\n        with codecs.open(self.dic_file, \"r\", self.encoding) as lines:\n            for l in lines:\n                # Trimming of the line :\n                # Split on white space, tab, slash backslah or open parenthesis\n                # and keep the first string, add EOL character\n                l2 = re.split(\"[ /\\\\\\t,\\(]\", l)[0] + \"\\n\"\n                self.dico.append(l2[:-1])\n                i, j = 0, 0\n                for k in [ord(c) for c in list(l2)]:\n                    self.count[i, j, k] += 1\n                    i = j\n                    j = k\n\n    def plot(self):\n        count2D = self.count.sum(axis=0)\n        p2D = count2D.astype(\"float\") / np.tile(sum(count2D.T), (256, 1)).T\n        p2D[np.isnan(p2D)] = 0\n\n        # For better contrast, we plot p^alpha instead of p\n        alpha = 0.33\n        p2Da = p2D**alpha\n        self.p2Da = p2Da[97:123, 97:123]\n\n        # We display only letters a to z, ie ASCII from 97 to 123.\n        plt.figure(figsize=(8, 8))\n        gr = plt.imshow(self.p2Da, interpolation=\"nearest\", cmap=mpl.cm.OrRd)\n        plt.axis(\"off\")\n        cbar = plt.colorbar(gr, orientation=\"vertical\")\n\n        for i in range(97, 123):\n            plt.text(\n                -1,\n                i - 97,\n                chr(i),\n                horizontalalignment=\"center\",\n                verticalalignment=\"center\",\n            )\n            plt.text(\n                i - 97,\n                -1,\n                chr(i),\n                horizontalalignment=\"center\",\n                verticalalignment=\"center\",\n            )\n\n    def __call__(self):\n        # For the random generator : what is the minimum and maximum number of letters\n        # in the words that we want to generate, and how many words for each length\n        smin, smax = 4, 12\n        K = 5\n\n        # Compute the probabilities by normalizing the counts\n        s = self.count.sum(axis=2)\n        st = np.tile(s.T, (256, 1, 1)).T\n        p = self.count.astype(\"float\") / st\n        p[np.isnan(p)] = 0\n\n        f = codecs.open(self.outfile, \"w\", self.encoding)\n        # Generate words\n        for size in range(smin, smax + 1):\n            total = 0\n            while total < K:\n                i, j = 0, 0\n                res = \"\"\n                while not j == 10:\n                    k = choice(range(256), 1, p=p[i, j, :])[0]\n                    res = res + chr(k)\n                    i, j = j, k\n                if len(res) == 1 + size:\n                    x = res[:-1]\n                    if res[:-1] in self.dico:\n                        x = res[:-1] + \"*\"\n                    total += 1\n                    print(x)\n                    f.write(x + \"\\n\")\n        f.close()","visibility":"show","key":"SzBHCXzDOD"},{"type":"outputs","id":"1ZzOWC2DNQ83Fx13ISlra","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"<>:25: SyntaxWarning: invalid escape sequence '\\('\n<>:25: SyntaxWarning: invalid escape sequence '\\('\n/tmp/ipykernel_8006/599884686.py:25: SyntaxWarning: invalid escape sequence '\\('\n  l2 = re.split(\"[ /\\\\\\t,\\(]\", l)[0] + \"\\n\"\n"},"key":"L8sfWK35g0"}],"visibility":"show","key":"W20OKsek0A"}],"visibility":"show","key":"g8Zvi9Nwig"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"French","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mqx38J61iD"}],"identifier":"french","label":"French","html_id":"french","implicit":true,"key":"SZDdrYqVRP"}],"key":"XYBaXrkI1J"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"fragment"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"gen_FR = word_generator(r\"_DATA/dic/FR_aisi.txt\")\ngen_FR.plot()\nplt.show()","visibility":"show","key":"vBB8Fx0Gqs"},{"type":"outputs","id":"qjmR97ce4ZrQfls2aR7lf","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_8006/599884686.py:25: SyntaxWarning: invalid escape sequence '\\('\n  l2 = re.split(\"[ /\\\\\\t,\\(]\", l)[0] + \"\\n\"\n"},"key":"v5xVFlmYDY"},{"type":"output","children":[],"jupyter_data":{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mFileNotFoundError\u001b[39m                         Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[4]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m gen_FR = \u001b[43mword_generator\u001b[49m\u001b[43m(\u001b[49m\u001b[33;43mr\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43m_DATA/dic/FR_aisi.txt\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\n\u001b[32m      2\u001b[39m gen_FR.plot()\n\u001b[32m      3\u001b[39m plt.show()\n\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[3]\u001b[39m\u001b[32m, line 14\u001b[39m, in \u001b[36mword_generator.__init__\u001b[39m\u001b[34m(self, dic_file)\u001b[39m\n\u001b[32m     11\u001b[39m proba_matrix = \u001b[33mr\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mmatrix_FR.png\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m     12\u001b[39m \u001b[38;5;28mself\u001b[39m.outfile = \u001b[33mr\u001b[39m\u001b[33m\"\u001b[39m\u001b[33moutput.txt\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m---> \u001b[39m\u001b[32m14\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mread_dic\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[3]\u001b[39m\u001b[32m, line 20\u001b[39m, in \u001b[36mword_generator.read_dic\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m     17\u001b[39m \u001b[38;5;28mself\u001b[39m.dico = []  \u001b[38;5;66;03m# to store the words of the dictionnary\u001b[39;00m\n\u001b[32m     19\u001b[39m \u001b[38;5;28mself\u001b[39m.count = np.zeros((\u001b[32m256\u001b[39m, \u001b[32m256\u001b[39m, \u001b[32m256\u001b[39m), dtype=\u001b[33m\"\u001b[39m\u001b[33mint32\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m---> \u001b[39m\u001b[32m20\u001b[39m \u001b[38;5;28;01mwith\u001b[39;00m \u001b[43mcodecs\u001b[49m\u001b[43m.\u001b[49m\u001b[43mopen\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mdic_file\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mr\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mencoding\u001b[49m\u001b[43m)\u001b[49m \u001b[38;5;28;01mas\u001b[39;00m lines:\n\u001b[32m     21\u001b[39m     \u001b[38;5;28;01mfor\u001b[39;00m l \u001b[38;5;129;01min\u001b[39;00m lines:\n\u001b[32m     22\u001b[39m         \u001b[38;5;66;03m# Trimming of the line :\u001b[39;00m\n\u001b[32m     23\u001b[39m         \u001b[38;5;66;03m# Split on white space, tab, slash backslah or open parenthesis\u001b[39;00m\n\u001b[32m     24\u001b[39m         \u001b[38;5;66;03m# and keep the first string, add EOL character\u001b[39;00m\n\u001b[32m     25\u001b[39m         l2 = re.split(\u001b[33m\"\u001b[39m\u001b[33m[ /\u001b[39m\u001b[38;5;130;01m\\\\\u001b[39;00m\u001b[38;5;130;01m\\t\u001b[39;00m\u001b[33m,\u001b[39m\u001b[33m\\\u001b[39m\u001b[33m(]\u001b[39m\u001b[33m\"\u001b[39m, l)[\u001b[32m0\u001b[39m] + \u001b[33m\"\u001b[39m\u001b[38;5;130;01m\\n\u001b[39;00m\u001b[33m\"\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32m<frozen codecs>:918\u001b[39m, in \u001b[36mopen\u001b[39m\u001b[34m(filename, mode, encoding, errors, buffering)\u001b[39m\n\n\u001b[31mFileNotFoundError\u001b[39m: [Errno 2] No such file or directory: '_DATA/dic/FR_aisi.txt'","ename":"FileNotFoundError","evalue":"[Errno 2] No such file or directory: '_DATA/dic/FR_aisi.txt'"},"key":"JEOfgrAFss"}],"visibility":"show","key":"ssZcw7YZAO"}],"visibility":"show","key":"pvsDHhN2yG"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"subslide"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"gen_FR()","visibility":"show","key":"z8kynw2kgi"},{"type":"outputs","id":"2uzCTmF7NP7rLMgB0IlAY","children":[],"visibility":"show","key":"KB5ENbpVPE"}],"visibility":"show","key":"KHEk57CbDH"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Swedish","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j13gzL46dQ"}],"identifier":"swedish","label":"Swedish","html_id":"swedish","implicit":true,"key":"P5WMJALWzF"}],"key":"N1dYaa5pFa"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"fragment"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"gen_SE = word_generator(r\"_DATA/dic/SE_aisi.txt\")\ngen_SE.plot()","visibility":"show","key":"Kjfw6JKlsV"},{"type":"outputs","id":"jtt06fs9_LYZfjOyZnx5Q","children":[],"visibility":"show","key":"gUAaL1IYhl"}],"visibility":"show","key":"XcQkdb1T7l"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"subslide"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"gen_SE()","visibility":"show","key":"X7hiSY0hCD"},{"type":"outputs","id":"EDPeRH50Qug9siVoqI8gA","children":[],"visibility":"show","key":"lDFvRLccJ3"}],"visibility":"show","key":"nnXJY6pqrR"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compare french and swedisch","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HzKYnDjKHp"}],"identifier":"compare-french-and-swedisch","label":"Compare french and swedisch","html_id":"compare-french-and-swedisch","implicit":true,"key":"WwnFSkxSvA"}],"key":"VdGGhraxuF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure()\nax = fig.add_subplot(1, 2, 1)\nax.imshow(gen_FR.p2Da, interpolation=\"nearest\", cmap=mpl.cm.OrRd)\nax.axis(\"off\")\nfor i in range(97, 123):\n    plt.text(\n        -1, i - 97, chr(i), horizontalalignment=\"center\", verticalalignment=\"center\"\n    )\n    plt.text(\n        i - 97, -1, chr(i), horizontalalignment=\"center\", verticalalignment=\"center\"\n    )\nplt.title(\"French\")\n\nax = fig.add_subplot(1, 2, 2)\nax.imshow(gen_SE.p2Da, interpolation=\"nearest\", cmap=mpl.cm.OrRd)\nax.axis(\"off\")\nfor i in range(97, 123):\n    plt.text(\n        -1, i - 97, chr(i), horizontalalignment=\"center\", verticalalignment=\"center\"\n    )\n    plt.text(\n        i - 97, -1, chr(i), horizontalalignment=\"center\", verticalalignment=\"center\"\n    )\nplt.title(\"Swedisch\")\nplt.show()","visibility":"show","key":"bmp2DyWF1I"},{"type":"outputs","id":"oarbyZJMDj2fq7LZ0xvRr","children":[],"visibility":"show","key":"pMzAw2Yc4A"}],"visibility":"show","key":"F7Hruq2AVH"}],"key":"oJKxlDq6Bq"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Ressources","url":"/ressources","group":"Data"},"next":{"title":"Exercices","url":"/exercises-2","group":"Data"}}},"domain":"http://localhost:3004"}