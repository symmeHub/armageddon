{"version":3,"kind":"Notebook","sha256":"3e0f8e0b905250d3652c6494f5559a7245120ecfa01691bfa788f89f261c39b1","slug":"gravity","location":"/ode/ressources/gravity.ipynb","dependencies":[],"frontmatter":{"title":"Simulation of a set of bodies subjected to gravity","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/symmeHub/positron","numbering":{"title":{"offset":2}},"source_url":"https://github.com/symmeHub/positron/blob/main/book/ode/ressources/gravity.ipynb","edit_url":"https://github.com/symmeHub/positron/edit/main/book/ode/ressources/gravity.ipynb","exports":[{"format":"ipynb","filename":"gravity.ipynb","url":"/armageddon/build/gravity-8965a416bed0a82e420b143c60ecace8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Scope","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f2E6OOkDjX"}],"identifier":"scope","label":"Scope","html_id":"scope","implicit":true,"key":"lCcPfzIEVZ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This notebook uses the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zfIn5bnbVv"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"(Point Mass Dynamics) PMD","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ty9itJFmJn"}],"key":"uAiFcrynnw"},{"type":"text","value":" class to simulate gravitational interaction between massive objects.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WONWAXySCr"}],"key":"b8DYXpg96J"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Required files","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Elvhkx4ecP"}],"key":"LStSFrexJk"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Before using this notebook, download the module ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"CHyMR570Zx"},{"type":"link","url":"/armageddon/build/PMD-6bb95a16675cd6323c18059b96986b67.py","static":true,"children":[{"type":"text","value":"PMD.py","key":"iFGncx2sxX"}],"urlSource":"PMD.py","protocol":"file","key":"LCGWzuSPmU"},{"type":"text","value":" and put it in your working directory.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"h6YD5irSHs"}],"key":"cJqomHQ1m3"}],"class":"important","key":"RU7GFDaDI4"},{"type":"heading","depth":2,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Coding","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"G5Wln71ynS"}],"identifier":"coding","label":"Coding","html_id":"coding","implicit":true,"key":"mq8t41Ae4a"}],"visibility":"show","key":"KaQIuKQ3jq"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib widget\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nfrom scipy import integrate, optimize, spatial\nfrom matplotlib import animation, rc\nfrom PMD import PMD, distances, MetaForce\n\nrc(\"animation\", html=\"html5\")\nnp.random.seed(333)","visibility":"show","key":"MzQbviGX3h"},{"type":"outputs","id":"Sih46CW46zPUqieRufdW_","children":[],"visibility":"show","key":"mDESNEhK22"}],"visibility":"show","key":"mkghDMZel3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class Gravity(PMD):\n    def __init__(self, G=6.67e-11, **kwargs):\n        \"\"\"\n        2D gravity\n        \"\"\"\n        self.G = G\n        super().__init__(**kwargs)\n\n    def derivative(self, X, t, cutoff_radius=1.0e-2):\n        \"\"\"\n        Acceleration de chaque masse !\n        \"\"\"\n        m, G = self.m, self.G\n        n = len(m)\n        P = X[: 2 * n].reshape(n, 2)\n        V = X[2 * n :].reshape(n, 2)\n        M = m * m[:, np.newaxis]\n        D, R, U = distances(P)\n        np.fill_diagonal(R, np.inf)\n        if cutoff_radius > 0.0:\n            R = np.where(R > cutoff_radius, R, cutoff_radius)\n        F = ((G * M * R**-2)[:, :, np.newaxis] * U).sum(axis=0)\n        A = (F.T / m).T\n        X2 = X.copy()\n        X2[: 2 * n] = V.flatten()\n        X2[2 * n :] = A.flatten()\n        return X2","key":"OXfhb8brnM"},{"type":"outputs","id":"C3SbgO-OoWfOETpQLZaRt","children":[],"key":"fyz3feioWx"}],"key":"QdZEPy68tE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Animation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MQ2jK7KmTs"}],"identifier":"animation","label":"Animation","html_id":"animation","implicit":true,"key":"cJRbhiTrWF"}],"key":"Nq9T8d17DA"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# SETUP\nG = 1.0e03\nnr = 3\nnt = 1\nnm = nr * nt + 1\nm = np.ones(nm) * 4.0e-3\nm[0] = 1.0\nr = np.linspace(1.0, 2.0, nr)\ntheta = np.linspace(0.0, np.pi * 2, nt, endpoint=False)\nR, Theta = np.meshgrid(r, theta)\nr = np.concatenate([[0.0], R.flatten()])\ntheta = np.concatenate([[0.0], Theta.flatten()])\n\nv = np.zeros_like(r)\nv[1:] = (\n    (G * m[0] / r[1:]) ** 0.5\n    * 0.75\n    * np.random.normal(loc=1.0, scale=0.05, size=nm - 1)\n)\nx = r * np.cos(theta)\ny = r * np.sin(theta)\nvx = -v * np.sin(theta)\nvy = v * np.cos(theta)\n\nP = np.array([x, y]).transpose()\nV = np.array([vx, vy]).transpose()\n\nvG = (V * m[:, np.newaxis]).sum(axis=0) / m.sum()\nV -= vG\n\ns = Gravity(m=m, P=P, V=V, G=G, nk=4000)\ndt = 1.0e-3\nnt = 50","visibility":"show","key":"RrgShmCTYI"},{"type":"outputs","id":"fvYDskfT_2NtviMmRDg8l","children":[],"visibility":"show","key":"oC5A5iiC8p"}],"visibility":"show","key":"lLPgWEOQ8d"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"pcolors = \"r\"\ntcolors = \"k\"\n\n\nfig = plt.figure()\nax = fig.add_subplot(1, 1, 1)\nax.set_aspect(\"equal\")\nmargin = 1.0\nplt.axis([-2, 2, -2, 2])\nplt.grid()\nax.axis(\"off\")\npoints = []\n\nmsize = 10.0 * (s.m / s.m.max()) ** (1.0 / 6.0)\nfor i in range(nm):\n    plc = len(pcolors)\n    pc = pcolors[i % plc]\n    tlc = len(tcolors)\n    tc = tcolors[i % tlc]\n    (trail,) = ax.plot([], [], \"-\" + tc)\n    (point,) = ax.plot([], [], \"o\" + pc, markersize=msize[i])\n    points.append(point)\n    points.append(trail)\n\n\ndef init():\n    for i in range(2 * nm):\n        points[i].set_data([], [])\n    return points\n\n\ndef animate(i):\n    s.solve(dt, nt)\n    x, y = s.xy()\n    for i in range(nm):\n        points[2 * i].set_data(x[i : i + 1], y[i : i + 1])\n        xt, yt = s.trail(i)\n        points[2 * i + 1].set_data(xt, yt)\n    return points\n\n\nanim = animation.FuncAnimation(\n    fig, animate, init_func=init, frames=1600, interval=20, blit=True\n)\n\n\nplt.close()\nanim\n# plt.show()","visibility":"show","key":"OPiebIaZRs"},{"type":"outputs","id":"yVVymAyEmfXDeecBgijWF","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"<matplotlib.animation.FuncAnimation at 0x7a8360140e00>","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"8a717edcf495aeb59a66e3452cfadad1","path":"/armageddon/build/8a717edcf495aeb59a66e3452cfadad1.html"}}},"key":"X2Z8LZqTTR"}],"visibility":"show","key":"CvEbBnBg85"}],"visibility":"show","key":"LzUUb0vjHc"}],"key":"hPyBfcoSFT"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Modelling the trajectory of a badminton shuttlecock","url":"/badminton","group":"ODE"},"next":{"title":"Molecular Dynamics : simulation of a crystal formation in 2D","url":"/molecular-dynamics","group":"ODE"}}},"domain":"http://localhost:3004"}